<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lava Jato do Di</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- CabeÃ§alho -->
  <header>
    <img src="logo.jpg" alt="Logo Lava Jato" class="logo">
    <h1>Lava Jato do Di ğŸš—ğŸ§¼</h1>
    <button id="toggleTema" class="tema-btn">ğŸŒ™</button>
    <div class="perfil-bolinha" onclick="abrirLogin()">
      ğŸ‘¤
    </div>
  </header>

  <!-- ConteÃºdo principal -->
  <main>
    <!-- FormulÃ¡rio -->
    <div class="formulario">
      <input id="funcionario" placeholder="Nome do funcionÃ¡rio">
      <select id="veiculo">
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">CaminhÃ£o</option>
      </select>
      <button onclick="adicionarRegistro()">Adicionar</button>
    </div>

    <!-- Registros -->
    <section>
      <h2>Registros</h2>
      <ul id="listaRegistros"></ul>
    </section>

    <!-- Ganhos -->
    <section>
      <h2>Ganhos por FuncionÃ¡rio</h2>
      <ul id="listaGanhos"></ul>
    </section>

    <!-- Resumo -->
    <section>
      <h2>Resumo do Dia</h2>
      <ul id="resumoDia"></ul>
    </section>
  </main>

  <!-- Login do dono -->
  <div class="login-dono" id="loginDono">
    <input type="password" id="senhaDono" placeholder="Senha do dono">
    <button onclick="loginDono()">Entrar</button>
  </div>

  <!-- Painel do dono -->
  <div class="painel" id="painelDono">
    <div class="painel-header">
      <span>Painel do Dono</span>
      <button onclick="logoutDono()">âŒ</button>
    </div>

    <div class="abas">
      <button onclick="mostrarAba('historico')">HistÃ³rico</button>
      <button onclick="mostrarAba('grafico')">GrÃ¡fico</button>
      <button onclick="finalizarDia()">Finalizar Dia</button>
    </div>

    <div class="aba-conteudo" id="aba-historico">
      <ul id="historicoRegistros"></ul>
    </div>

    <div class="aba-conteudo" id="aba-grafico" style="display:none;">
      <canvas id="graficoHistorico"></canvas>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const valores = { carro: 20, moto: 10, caminhao: 50 };
    let registros = JSON.parse(localStorage.getItem("registros")) || [];
    let historico = JSON.parse(localStorage.getItem("historico")) || [];
    let donoLogado = false;
    const senhaCorreta = "1234";

    // Chart.js
    const ctx = document.getElementById("graficoHistorico").getContext("2d");
    const grafico = new Chart(ctx, {
      type: "bar",
      data: { labels: [], datasets: [{ label: "Lavagens por dia", data: [], backgroundColor: "#00bfff" }] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    function salvarLocal() {
      localStorage.setItem("registros", JSON.stringify(registros));
      localStorage.setItem("historico", JSON.stringify(historico));
    }

    function adicionarRegistro() {
      const funcionario = document.getElementById("funcionario").value.trim();
      const veiculo = document.getElementById("veiculo").value;
      if (!funcionario) return;

      registros.push({ funcionario, veiculo });
      historico.push({ funcionario, veiculo, data: new Date().toLocaleString() });

      document.getElementById("funcionario").value = "";
      salvarLocal();
      atualizarTela();
    }

    function atualizarTela() {
      // Lista registros
      const lista = document.getElementById("listaRegistros");
      lista.innerHTML = "";
      registros.forEach(r => {
        const li = document.createElement("li");
        li.textContent = `${r.funcionario} lavou um ${r.veiculo} (+R$ ${valores[r.veiculo]})`;
        lista.appendChild(li);
      });

      // Ganhos
      const ganhos = registros.reduce((acc, r) => {
        acc[r.funcionario] = (acc[r.funcionario] || 0) + valores[r.veiculo];
        return acc;
      }, {});
      const listaGanhos = document.getElementById("listaGanhos");
      listaGanhos.innerHTML = "";
      for (const [nome, total] of Object.entries(ganhos)) {
        const li = document.createElement("li");
        li.textContent = `${nome}: R$ ${total}`;
        listaGanhos.appendChild(li);
      }

      // Resumo
      const resumo = { carro: 0, moto: 0, caminhao: 0 };
      registros.forEach(r => resumo[r.veiculo]++);
      const resumoDia = document.getElementById("resumoDia");
      resumoDia.innerHTML = `
        <li>Carros: ${resumo.carro}</li>
        <li>Motos: ${resumo.moto}</li>
        <li>CaminhÃµes: ${resumo.caminhao}</li>
      `;

      // HistÃ³rico (painel dono)
      const historicoUl = document.getElementById("historicoRegistros");
      historicoUl.innerHTML = "";
      historico.forEach(h => {
        const li = document.createElement("li");
        li.textContent = `${h.data} - ${h.funcionario} lavou ${h.veiculo}`;
        historicoUl.appendChild(li);
      });

      // GrÃ¡fico
      const dataHoje = new Date().toLocaleDateString();
      const countHoje = registros.length;
      const idx = grafico.data.labels.indexOf(dataHoje);
      if (idx === -1) {
        grafico.data.labels.push(dataHoje);
        grafico.data.datasets[0].data.push(countHoje);
      } else {
        grafico.data.datasets[0].data[idx] = countHoje;
      }
      grafico.update();
    }

    function abrirLogin() {
      document.getElementById("loginDono").style.display = "block";
    }

    function loginDono() {
      const senha = document.getElementById("senhaDono").value;
      if (senha === senhaCorreta) {
        donoLogado = true;
        document.getElementById("painelDono").style.display = "block";
        document.getElementById("loginDono").style.display = "none";
      } else {
        alert("Senha incorreta!");
      }
    }

    function logoutDono() {
      donoLogado = false;
      document.getElementById("painelDono").style.display = "none";
      document.getElementById("loginDono").style.display = "none";
    }

    function mostrarAba(aba) {
      document.getElementById("aba-historico").style.display = aba === "historico" ? "block" : "none";
      document.getElementById("aba-grafico").style.display = aba === "grafico" ? "block" : "none";
    }

    function finalizarDia() {
      registros = [];
      salvarLocal();
      atualizarTela();
      alert("Dia finalizado com sucesso! âœ…");
    }

    // === AlternÃ¢ncia de tema com localStorage ===
    const body = document.body;
    const toggleBtn = document.getElementById("toggleTema");

    const temaSalvo = localStorage.getItem("tema");
    if (temaSalvo === "dark") {
      body.classList.add("dark");
      toggleBtn.textContent = "ğŸŒ™";
    } else {
      body.classList.remove("dark");
      toggleBtn.textContent = "â˜€ï¸";
    }

    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      if (body.classList.contains("dark")) {
        toggleBtn.textContent = "ğŸŒ™";
        localStorage.setItem("tema", "dark");
      } else {
        toggleBtn.textContent = "â˜€ï¸";
        localStorage.setItem("tema", "light");
      }
    });

    atualizarTela();
  </script>
</body>
</html>
