<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lava Jato do Di</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Cabe√ßalho -->
  <header>
    <img src="logo.png" alt="Logo Lava Jato" class="logo">
    <h1>Lava Jato do Di üöóüßº</h1>
    <button id="toggleTema" class="tema-btn">üåô</button>
  </header>

  <!-- Conte√∫do principal -->
  <main>
    <!-- Formul√°rio -->
    <div class="formulario">
      <input id="funcionario" placeholder="Nome do funcion√°rio">
      <select id="veiculo">
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">Caminh√£o</option>
      </select>
      <button onclick="adicionarRegistro()">Adicionar</button>
    </div>

    <!-- Registros -->
    <section>
      <h2>Registros</h2>
      <ul id="listaRegistros"></ul>
    </section>

    <!-- Ganhos -->
    <section>
      <h2>Ganhos por Funcion√°rio</h2>
      <ul id="listaGanhos"></ul>
    </section>

    <!-- Resumo -->
    <section>
      <h2>Resumo do Dia</h2>
      <ul id="resumoDia"></ul>
      <button id="finalizarDia" class="finalizar-btn">Finalizar Dia</button>
    </section>
  </main>

  <!-- Bot√£o perfil dono (com logo) -->
  <div id="perfilDono" class="perfil-dono">
    <img src="logo.png" alt="Perfil Dono">
  </div>

  <!-- Painel do dono -->
  <div class="painel" id="painelDono">
    <div class="painel-header">
      <span>Painel do Dono</span>
      <button onclick="fecharPainel()">‚ùå</button>
    </div>

    <div class="abas">
      <button onclick="mostrarAba('historico')">Hist√≥rico</button>
      <button onclick="mostrarAba('grafico')">Gr√°fico</button>
    </div>

    <div class="aba-conteudo" id="aba-historico">
      <ul id="historicoRegistros"></ul>
    </div>

    <div class="aba-conteudo" id="aba-grafico" style="display:none;">
      <canvas id="graficoHistorico"></canvas>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const valores = { carro: 20, moto: 10, caminhao: 50 };
    let registros = JSON.parse(localStorage.getItem("registrosDia")) || [];
    let historico = JSON.parse(localStorage.getItem("historicoGeral")) || [];

    // Chart.js
    const ctx = document.getElementById("graficoHistorico").getContext("2d");
    const grafico = new Chart(ctx, {
      type: "bar",
      data: { labels: [], datasets: [{ label: "Lavagens por dia", data: [], backgroundColor: "#00bfff" }] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    function salvarDados() {
      localStorage.setItem("registrosDia", JSON.stringify(registros));
      localStorage.setItem("historicoGeral", JSON.stringify(historico));
    }

    function adicionarRegistro() {
      const funcionario = document.getElementById("funcionario").value.trim();
      const veiculo = document.getElementById("veiculo").value;
      if (!funcionario) return;

      const dataAgora = new Date().toLocaleString();
      registros.push({ funcionario, veiculo });
      historico.push({ funcionario, veiculo, data: dataAgora });

      document.getElementById("funcionario").value = "";
      salvarDados();
      atualizarTela();
    }

    function finalizarDia() {
      registros = [];
      localStorage.setItem("registrosDia", JSON.stringify([]));
      atualizarTela();
    }

    function atualizarTela() {
      // Lista registros
      const lista = document.getElementById("listaRegistros");
      lista.innerHTML = "";
      registros.forEach(r => {
        const li = document.createElement("li");
        li.textContent = `${r.funcionario} lavou um ${r.veiculo} (+R$ ${valores[r.veiculo]})`;
        lista.appendChild(li);
      });

      // Ganhos
      const ganhos = registros.reduce((acc, r) => {
        acc[r.funcionario] = (acc[r.funcionario] || 0) + valores[r.veiculo];
        return acc;
      }, {});
      const listaGanhos = document.getElementById("listaGanhos");
      listaGanhos.innerHTML = "";
      for (const [nome, total] of Object.entries(ganhos)) {
        const li = document.createElement("li");
        li.textContent = `${nome}: R$ ${total}`;
        listaGanhos.appendChild(li);
      }

      // Resumo
      const resumo = { carro: 0, moto: 0, caminhao: 0 };
      registros.forEach(r => resumo[r.veiculo]++);
      const resumoDia = document.getElementById("resumoDia");
      resumoDia.innerHTML = `
        <li>Carros: ${resumo.carro}</li>
        <li>Motos: ${resumo.moto}</li>
        <li>Caminh√µes: ${resumo.caminhao}</li>
      `;

      // Hist√≥rico (painel dono)
      const historicoUl = document.getElementById("historicoRegistros");
      historicoUl.innerHTML = "";
      historico.forEach(h => {
        const li = document.createElement("li");
        li.textContent = `${h.data} - ${h.funcionario} lavou ${h.veiculo}`;
        historicoUl.appendChild(li);
      });

      // Gr√°fico
      const dataHoje = new Date().toLocaleDateString();
      const countHoje = registros.length;
      const idx = grafico.data.labels.indexOf(dataHoje);
      if (idx === -1) {
        grafico.data.labels.push(dataHoje);
        grafico.data.datasets[0].data.push(countHoje);
      } else {
        grafico.data.datasets[0].data[idx] = countHoje;
      }
      grafico.update();
    }

    // === Painel do dono ===
    const perfilBtn = document.getElementById("perfilDono");
    const painel = document.getElementById("painelDono");

    perfilBtn.addEventListener("click", () => {
      painel.style.display = painel.style.display === "block" ? "none" : "block";
    });

    function fecharPainel() {
      painel.style.display = "none";
    }

    function mostrarAba(aba) {
      document.getElementById("aba-historico").style.display = aba === "historico" ? "block" : "none";
      document.getElementById("aba-grafico").style.display = aba === "grafico" ? "block" : "none";
    }

    // === Tema com localStorage ===
    const body = document.body;
    const toggleBtn = document.getElementById("toggleTema");
    const temaSalvo = localStorage.getItem("tema");
    if (temaSalvo === "dark") body.classList.add("dark");

    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      localStorage.setItem("tema", body.classList.contains("dark") ? "dark" : "light");
    });

    // Finalizar dia
    document.getElementById("finalizarDia").addEventListener("click", finalizarDia);

    // Inicializa
    atualizarTela();
  </script>
</body>
</html>
